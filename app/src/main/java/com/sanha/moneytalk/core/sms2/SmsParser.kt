package com.sanha.moneytalk.core.sms2

/**
 * SMS 카테고리 추론 유틸리티
 *
 * 가게명과 SMS 본문에서 키워드를 찾아 카테고리를 결정합니다.
 * 250+ 키워드 기반의 로컬 분류기로, API 호출 없이 빠르게 처리합니다.
 *
 * 주요 사용처:
 * - CategoryClassifierService: Tier 2 키워드 매칭 (Room DB 미스 시)
 *
 * @see com.sanha.moneytalk.feature.home.data.CategoryClassifierService
 */
object SmsParser {

    /**
     * 카테고리 매핑 (가게명 키워드 기반)
     * 뱅크샐러드 스타일의 세분화된 카테고리 분류
     */
    private val categoryKeywords = mapOf(
        // 식비 (음식 관련 전부 → "식비"로 통합)
        "식비" to listOf(
            // 고기
            "푸줏간", "정육", "고기", "삼겹살", "갈비", "한우", "소고기", "돼지고기",
            // 일식
            "초밥", "스시", "사시미", "라멘", "우동", "돈까스", "일식", "이자카야",
            "백소정", "스시로", "쿠라스시",
            // 중식
            "짜장", "짬뽕", "중국집", "중식", "마라탕", "훠궈",
            // 한식
            "한식", "찌개", "탕", "냉면", "비빔밥", "국밥", "설렁탕", "갈비탕",
            "김치찌개", "된장찌개", "부대찌개",
            // 치킨
            "치킨", "BBQ", "교촌", "BHC", "굽네", "네네", "푸라닭", "호식이",
            // 피자
            "피자", "도미노", "피자헛", "미스터피자", "파파존스",
            // 패스트푸드
            "맥도날드", "버거킹", "KFC", "롯데리아", "맘스터치", "서브웨이",
            // 분식
            "김밥", "분식", "떡볶이", "라면", "국수",
            // 편의점
            "편의점", "GS25", "CU", "세븐일레븐", "이마트24", "미니스톱",
            // 마트 (식료품 중심)
            "이마트", "홈플러스", "롯데마트", "코스트코", "트레이더스",
            "마트", "하나로", "농협마트"
        ),
        // 카페
        "카페" to listOf(
            "스타벅스", "투썸", "이디야", "커피빈", "탐앤탐스", "할리스",
            "메가커피", "컴포즈", "빽다방", "더벤티", "파스쿠찌",
            "카페", "커피",
            // 베이커리
            "베이커리", "빵집", "제과", "던킨", "크리스피", "파리바게뜨", "뚜레쥬르",
            // 아이스크림/디저트
            "배스킨라빈스", "나뚜루", "하겐다즈", "설빙", "아이스크림", "빙수"
        ),
        // 교통
        "교통" to listOf(
            "택시", "카카오T", "타다", "우버",
            "버스", "지하철", "KTX", "SRT", "코레일", "기차",
            "주유소", "SK에너지", "GS칼텍스", "현대오일", "S-OIL", "알뜰주유",
            "하이패스", "톨게이트", "고속도로", "주차", "파킹"
        ),
        // 쇼핑
        "쇼핑" to listOf(
            // 온라인쇼핑
            "쿠팡", "11번가", "G마켓", "옥션", "위메프", "티몬",
            "네이버쇼핑", "SSG", "롯데ON", "현대Hmall",
            // 패션
            "무신사", "지그재그", "에이블리", "29CM", "W컨셉",
            "유니클로", "자라", "H&M",
            // 뷰티
            "올리브영", "롭스", "화장품", "뷰티",
            // 생활용품
            "다이소", "아트박스", "이케아", "오늘의집"
        ),
        // 구독
        "구독" to listOf(
            "넷플릭스", "유튜브", "스포티파이", "멜론", "지니", "플로", "바이브",
            "왓챠", "웨이브", "티빙", "시즌", "쿠팡플레이", "디즈니플러스",
            "애플뮤직", "애플TV", "아마존", "프라임",
            "구독", "정기결제", "자동결제", "멤버십"
        ),
        // 의료/건강
        "의료/건강" to listOf(
            "병원", "의원", "클리닉", "치과", "안과", "피부과", "내과", "외과",
            "약국", "약"
        ),
        // 운동
        "운동" to listOf(
            "헬스", "피트니스", "짐", "요가", "필라테스", "PT"
        ),
        // 문화/여가
        "문화/여가" to listOf(
            "CGV", "메가박스", "롯데시네마", "영화관", "영화",
            "놀이공원", "에버랜드", "롯데월드", "키자니아",
            "노래방", "PC방", "당구장", "볼링장", "찜질방",
            "여행", "호텔", "펜션", "에어비앤비", "야놀자", "여기어때",
            "티켓", "공연", "뮤지컬", "콘서트", "전시"
        ),
        // 교육
        "교육" to listOf(
            "학원", "학습", "교육", "인강", "클래스101", "패스트캠퍼스",
            "책", "서점", "교보문고", "영풍문고", "알라딘", "예스24"
        ),
        // 생활
        "생활" to listOf(
            "통신", "SKT", "KT", "LG유플러스", "알뜰폰",
            "전기", "가스", "수도", "관리비", "공과금",
            "미용실", "헤어", "네일", "왁싱"
        ),
        // 배달 (식비의 소 카테고리)
        "배달" to listOf(
            "배달의민족", "요기요", "쿠팡이츠", "배민", "위메프오", "땡겨요", "배달"
        ),
        // 보험
        "보험" to listOf(
            "보험", "보험료",
            "삼성화", "현대해", "메리츠", "DB손해", "한화손해", "흥국화"
        )
    )

    /**
     * 카테고리 키워드 사전 lowercase 캐시
     * inferCategory()에서 매번 keyword.lowercase() 호출 방지 (250+회 문자열 생성 제거)
     */
    private val categoryKeywordsLower: Map<String, List<String>> =
        categoryKeywords.mapValues { (_, keywords) ->
            keywords.map { it.lowercase() }
        }

    /**
     * 카테고리 추론 (키워드 기반)
     *
     * 가게명과 SMS 본문에서 키워드를 찾아 카테고리를 결정합니다.
     * categoryKeywords 맵에 정의된 키워드와 매칭합니다.
     *
     * @param storeName 가게명
     * @param message SMS 본문 (추가 키워드 탐색용)
     * @return 매칭된 카테고리 (없으면 "미분류")
     */
    fun inferCategory(storeName: String, message: String): String {
        val combinedText = "$storeName $message".lowercase()

        // 사전 lowercase 캐시 사용 (매번 keyword.lowercase() 호출 방지)
        for ((category, keywords) in categoryKeywordsLower) {
            for (keyword in keywords) {
                if (combinedText.contains(keyword)) {
                    return category
                }
            }
        }

        return "미분류"
    }
}
